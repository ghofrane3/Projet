<div class="product-form-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <button class="btn-back" routerLink="/admin/dashboard">‚Üê Retour</button>
      <h1>‚ûï Ajouter un produit</h1>
    </div>
    <button class="btn-save" (click)="onSubmit()" [disabled]="loading">
      <span *ngIf="!loading">üíæ Enregistrer</span>
      <span *ngIf="loading">‚è≥ Cr√©ation...</span>
    </button>
  </div>

  <!-- Messages -->
  <div *ngIf="success" class="alert-success">‚úÖ {{ success }}</div>
  <div *ngIf="errors.length > 0" class="alert-errors">
    <p *ngFor="let err of errors">‚ùå {{ err }}</p>
  </div>

  <div class="form-grid">

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- COLONNE GAUCHE                       -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="col-left">

      <!-- Informations de base -->
      <div class="card">
        <h2>üìã Informations g√©n√©rales</h2>

        <div class="form-group">
          <label>Nom du produit *</label>
          <input type="text" [(ngModel)]="product.name"
                 placeholder="Ex: T-shirt Blanc Classique"
                 maxlength="100" />
          <small>{{ product.name.length }}/100</small>
        </div>

        <div class="form-group">
          <label>Description *</label>
          <textarea [(ngModel)]="product.description"
                    placeholder="D√©crivez le produit, ses mati√®res, sa coupe..."
                    rows="5" maxlength="2000"></textarea>
          <small>{{ product.description.length }}/2000</small>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Marque</label>
            <input type="text" [(ngModel)]="product.brand" placeholder="Ex: Fashion Store" />
          </div>
          <div class="form-group">
            <label>Mati√®re</label>
            <input type="text" [(ngModel)]="product.material" placeholder="Ex: Coton 100%, Polyester..." />
          </div>
        </div>

        <div class="form-group">
          <label>SKU (Code produit, optionnel)</label>
          <input type="text" [(ngModel)]="product.sku" placeholder="Ex: TSH-BLANC-001" />
        </div>
      </div>

      <!-- Prix et Stock -->
      <div class="card">
        <h2>üí∞ Prix et Stock</h2>
        <div class="form-row">
          <div class="form-group">
            <label>Prix de vente (DT) *</label>
            <div class="input-with-icon">
              <span class="icon">DT</span>
              <input type="number" [(ngModel)]="product.price"
                     placeholder="0.00" min="0" step="0.01" />
            </div>
          </div>
          <div class="form-group">
            <label>Prix original (avant promo)</label>
            <div class="input-with-icon">
              <span class="icon">DT</span>
              <input type="number" [(ngModel)]="product.originalPrice"
                     placeholder="0.00" min="0" step="0.01" />
            </div>
          </div>
        </div>

        <div *ngIf="product.originalPrice && product.price" class="promo-badge">
          üè∑Ô∏è R√©duction : {{ ((1 - product.price / product.originalPrice) * 100).toFixed(0) }}%
        </div>

        <div class="form-group">
          <label>Stock disponible *</label>
          <input type="number" [(ngModel)]="product.stock"
                 placeholder="0" min="0" />
          <div class="stock-status" *ngIf="product.stock !== null">
            <span [class]="product.stock > 10 ? 'in-stock' : product.stock > 0 ? 'low-stock' : 'out-stock'">
              {{ product.stock > 10 ? '‚úÖ En stock' : product.stock > 0 ? '‚ö†Ô∏è Stock faible' : '‚ùå Rupture de stock' }}
            </span>
          </div>
        </div>
      </div>

      <!-- Tags -->
      <div class="card">
        <h2>üè∑Ô∏è Tags</h2>
        <div class="tag-input">
          <input type="text" [(ngModel)]="newTag"
                 placeholder="Ex: √©t√©, casual, sport..."
                 (keydown)="onTagKeydown($event)" />
          <button type="button" (click)="addTag()">Ajouter</button>
        </div>
        <div class="tags-list">
          <span class="tag" *ngFor="let tag of tags; let i = index">
            {{ tag }} <button (click)="removeTag(i)">√ó</button>
          </span>
        </div>
        <small>Appuyez sur Entr√©e ou virgule pour ajouter</small>
      </div>

    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- COLONNE DROITE                       -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="col-right">

      <!-- Images -->
      <div class="card">
        <h2>üñºÔ∏è Images du produit *</h2>
        <p class="hint">Max 5 images ‚Ä¢ JPG, PNG, WebP ‚Ä¢ 5MB max ‚Ä¢ La 1√®re = image principale</p>

        <!-- Zone de drag & drop -->
        <div class="upload-zone"
             [class.drag-over]="dragOver"
             (dragover)="onDragOver($event)"
             (dragleave)="onDragLeave()"
             (drop)="onDrop($event)"
             (click)="fileInput.click()">
          <div class="upload-icon">üì∏</div>
          <p>Glissez vos images ici ou <strong>cliquez pour parcourir</strong></p>
          <small>JPG, PNG, WebP ‚Äî Max 5 images ‚Äî 5MB par image</small>
          <input #fileInput type="file" multiple accept="image/*"
                 (change)="onFileSelect($event)" style="display:none" />
        </div>

        <!-- Pr√©visualisation -->
        <div class="image-previews" *ngIf="previewUrls.length > 0">
          <div class="preview-item" *ngFor="let url of previewUrls; let i = index">
            <img [src]="url" [alt]="'Image ' + (i+1)" />
            <div class="preview-overlay">
              <button class="btn-main" (click)="setMainImage(i)" title="D√©finir comme principale">
                {{ i === 0 ? '‚≠ê Principale' : '‚òÜ Principale' }}
              </button>
              <button class="btn-remove" (click)="removeImage(i)">üóëÔ∏è</button>
            </div>
            <span *ngIf="i === 0" class="main-badge">PRINCIPALE</span>
          </div>
        </div>
      </div>

      <!-- Cat√©gorie et Genre -->
      <div class="card">
        <h2>üìÇ Cat√©gorie</h2>

        <div class="form-group">
          <label>Cat√©gorie *</label>
          <select [(ngModel)]="product.category" (ngModelChange)="onCategoryChange()">
            <option value="">-- S√©lectionnez une cat√©gorie --</option>
            <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
          </select>
        </div>

        <div class="form-group">
          <label>Genre *</label>
          <div class="gender-buttons">
            <button *ngFor="let g of genders" type="button"
                    [class.active]="product.gender === g"
                    (click)="product.gender = g">
              {{ g }}
            </button>
          </div>
        </div>
      </div>

      <!-- Tailles -->
      <div class="card" *ngIf="product.category && getSizesForCategory().length > 0">
        <h2>üìè Tailles disponibles</h2>
        <div class="sizes-grid">
          <button *ngFor="let size of getSizesForCategory()" type="button"
                  [class.selected]="isSizeSelected(size)"
                  (click)="toggleSize(size)"
                  class="size-btn">
            {{ size }}
          </button>
        </div>
        <small>{{ selectedSizes.length }} taille(s) s√©lectionn√©e(s)</small>
      </div>

      <!-- Couleurs -->
      <div class="card">
        <h2>üé® Couleurs disponibles</h2>

        <div class="color-input">
          <input type="text" [(ngModel)]="newColor.name" placeholder="Ex: Rouge cerise" />
          <input type="color" [(ngModel)]="newColor.hex" title="Choisir la couleur" />
          <button type="button" (click)="addColor()">Ajouter</button>
        </div>

        <div class="colors-list">
          <div class="color-item" *ngFor="let color of colors; let i = index">
            <span class="color-swatch" [style.backgroundColor]="color.hex"></span>
            <span class="color-name">{{ color.name }}</span>
            <button (click)="removeColor(i)">√ó</button>
          </div>
        </div>
      </div>

      <!-- Visibilit√© -->
      <div class="card">
        <h2>üëÅÔ∏è Visibilit√©</h2>
        <label class="toggle-label">
          <div class="toggle" [class.active]="product.featured" (click)="product.featured = !product.featured">
            <div class="toggle-dot"></div>
          </div>
          <div>
            <strong>Produit en vedette</strong>
            <p>Afficher sur la page d'accueil</p>
          </div>
        </label>
      </div>

    </div>
  </div>

  <!-- Bouton de sauvegarde bas de page -->
  <div class="form-footer">
    <button class="btn-cancel" routerLink="/admin/products">Annuler</button>
    <button class="btn-save-bottom" (click)="onSubmit()" [disabled]="loading">
      <span *ngIf="!loading">üíæ Cr√©er le produit</span>
      <span *ngIf="loading">‚è≥ Cr√©ation en cours...</span>
    </button>
  </div>

</div>
