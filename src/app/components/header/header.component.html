<header class="header" [class.header--scrolled]="scrolled" [class.header--hidden]="hidden">

  <!-- TOP BAR -->
  <div class="header__top">
    <div class="header__top-inner">
      <span class="header__top-msg">
        Livraison gratuite Ã  partir de 99 DT
      </span>
      <div class="header__top-links">
        <a *ngIf="isLoggedIn()" routerLink="/order-confirmation" class="header__top-link">
          Suivi de commande
        </a>
        <a href="#" class="header__top-link">Aide</a>
        <span class="header__top-locale">ðŸ‡¹ðŸ‡³ Tunisie</span>
      </div>
    </div>
  </div>

  <!-- MAIN BAR -->
  <div class="header__main">
    <div class="header__inner">

      <!-- Burger (mobile) -->
      <button class="header__burger"
              (click)="toggleMenu()"
              [class.header__burger--open]="menuOpen"
              aria-label="Menu">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <!-- Logo -->
      <a class="header__logo" routerLink="/">
        <span class="header__logo-word">Fashion</span>
        <span class="header__logo-sep"></span>
        <span class="header__logo-sub">Store</span>
      </a>

      <!-- Nav -->
      <nav class="header__nav" [class.header__nav--open]="menuOpen">
        <ul class="header__nav-list">

          <li class="header__nav-item">
            <a routerLink="/" class="header__nav-link"
               routerLinkActive="header__nav-link--active"
               [routerLinkActiveOptions]="{exact:true}"
               (click)="closeMenu()">Accueil</a>
          </li>

          <li class="header__nav-item header__nav-item--drop">
            <a class="header__nav-link">
              CatÃ©gories
              <svg class="header__nav-chevron" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M4 6l4 4 4-4"/>
              </svg>
            </a>
            <div class="header__drop">
              <div class="header__drop-inner">
                <a routerLink="/category/femme"      class="header__drop-link" (click)="closeMenu()">
                  <span class="header__drop-name">Femme</span>
                  <span class="header__drop-sub">180+ articles</span>
                </a>
                <a routerLink="/category/homme"      class="header__drop-link" (click)="closeMenu()">
                  <span class="header__drop-name">Homme</span>
                  <span class="header__drop-sub">140+ articles</span>
                </a>
                <a routerLink="/category/enfant"     class="header__drop-link" (click)="closeMenu()">
                  <span class="header__drop-name">Enfant</span>
                  <span class="header__drop-sub">90+ articles</span>
                </a>
                <a routerLink="/category/accessoire" class="header__drop-link" (click)="closeMenu()">
                  <span class="header__drop-name">Accessoires</span>
                  <span class="header__drop-sub">120+ articles</span>
                </a>
                <a routerLink="/products" class="header__drop-all" (click)="closeMenu()">
                  Voir tout â†’
                </a>
              </div>
            </div>
          </li>

          <li class="header__nav-item">
            <a routerLink="/new" class="header__nav-link"
               routerLinkActive="header__nav-link--active"
               (click)="closeMenu()">NouveautÃ©s</a>
          </li>

          <li class="header__nav-item">
            <a routerLink="/sale" class="header__nav-link header__nav-link--sale"
               routerLinkActive="header__nav-link--active"
               (click)="closeMenu()">Soldes</a>
          </li>

        </ul>
      </nav>

      <!-- Actions -->
      <div class="header__actions">

        <!-- Search -->
        <div class="header__search" [class.header__search--open]="searchOpen">
          <input #searchInput
                 type="text"
                 [(ngModel)]="searchQuery"
                 (keyup.enter)="doSearch()"
                 placeholder="Rechercherâ€¦"
                 class="header__search-input">
          <button class="header__icon-btn" (click)="toggleSearch()" aria-label="Rechercher">
            <svg *ngIf="!searchOpen" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
            </svg>
            <svg *ngIf="searchOpen" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
          </button>
        </div>

        <!-- User (logged out) -->
        <ng-container *ngIf="!isLoggedIn()">
          <a routerLink="/login" class="header__icon-btn" title="Connexion">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
          </a>
        </ng-container>

        <!-- User (logged in) -->
        <ng-container *ngIf="isLoggedIn()">
          <div class="header__user" [class.header__user--open]="userMenuOpen">
            <button class="header__user-btn" (click)="toggleUserMenu()">
              <span class="header__user-avatar">
                {{ currentUser?.firstName?.charAt(0)?.toUpperCase() || '?' }}
              </span>
              <svg class="header__nav-chevron" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M4 6l4 4 4-4"/>
              </svg>
            </button>
            <div class="header__user-drop">
              <a routerLink="/account"  class="header__user-item" (click)="closeUserMenu()">Mon compte</a>
              <a routerLink="/orders"   class="header__user-item" (click)="closeUserMenu()">Mes commandes</a>
              <a routerLink="/wishlist" class="header__user-item" (click)="closeUserMenu()">Favoris</a>
              <ng-container *ngIf="isAdmin()">
                <div class="header__user-sep"></div>
                <a routerLink="/admin/dashboard" class="header__user-item" (click)="closeUserMenu()">Administration</a>
              </ng-container>
              <div class="header__user-sep"></div>
              <button class="header__user-item header__user-item--out"
                      (click)="logout(); closeUserMenu()">DÃ©connexion</button>
            </div>
          </div>
        </ng-container>

        <!-- Wishlist -->
        <a routerLink="/wishlist" class="header__icon-btn header__icon-btn--rel" title="Favoris">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
          </svg>
          <span *ngIf="wishlistCount > 0" class="header__badge">{{ wishlistCount }}</span>
        </a>

        <!-- Cart -->
        <button class="header__cart" (click)="goToCart()">
          <span class="header__cart-icon-wrap">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
            </svg>
            <span *ngIf="cartItemsCount > 0" class="header__badge">{{ cartItemsCount }}</span>
          </span>
          <span class="header__cart-label">Panier</span>
          <span *ngIf="cartTotal > 0" class="header__cart-total">{{ cartTotal.toFixed(2) }} DT</span>
        </button>

      </div>
    </div>
  </div>

  <!-- Mobile nav overlay -->
  <div class="header__overlay" [class.header__overlay--on]="menuOpen" (click)="closeMenu()"></div>

</header>
